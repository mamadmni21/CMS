<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Purchase Order Approval</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/css/purchasing_order_approval.css') }}" rel="stylesheet">

    <!-- Add this in your <head> or just before </body> -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#pur-req-select').select2({
                placeholder: "Search ID here",
                allowClear: true,
                width: '100%'  // This fixes the layout issue
                
            });


            // Auto-submit only after full selection
            $('#pur-req-select').on('select2:select', function () {
                $('#search-form').submit();
            });
        });
    </script>

</head>
<body>

<!-- Top Bar -->
<div class="top-bar">
    <div class="top-left">
        <img src="{{ url_for('static', filename='assets/img/logo_cms.png') }}" alt="CMS Icon">
        <h1>Purchase Order Approval</h1>
    </div>
    <div class="top-right">
      <a href="javascript:history.back()" class="back-button">
        <span class="material-icons">arrow_back</span>
      </a>
    </div>
</div>

<div class="content-container">
    <!-- Content Box 1: Table -->
    <div class="content-box">
        <h2>Pending Purchase Requests</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>User</th><th>Item</th><th>Qty</th><th>Unit</th><th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for req in pur_reqs %}
                <tr>
                    <td>{{ req.pur_req_id }}</td>
                    <td>{{ req.pur_req_usr_name }}</td>
                    <td>{{ req.pur_req_itm_name }}</td>
                    <td>{{ req.pur_req_itm_qty }}</td>
                    <td>{{ req.pur_req_itm_unit }}</td>
                    <td>{{ req.pur_req_sts }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Content Box 2: Form -->
    <div class="content-box">
        <h2>Approve or Reject Request</h2>
        <!-- GET form for selecting purchase request -->
        <form id="search-form" method="GET" style="max-width: 200px; margin: 0px; padding-bottom: 30px;">
            <label for="pur-req-select">Purchase Request ID</label>
            <div style="width: 190px; margin-left: 0px; padding: 0px;">
                <select id="pur-req-select" name="selected_id" style="width: 100px; margin-left: 0px;">
                    <option></option>
                    {% for req in pur_reqs %}
                        <option value="{{ req.pur_req_id }}" {% if selected_id|string == req.pur_req_id|string %}selected{% endif %}>
                            {{ req.pur_req_id }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </form>


        <!-- POST form for Approve / Reject actions -->
        {% if selected_req %}
            <form method="POST">
                <input type="hidden" name="pur_req_id" value="{{ selected_req.pur_req_id }}">

                <label>User Name</label>
                <input type="text" name="pur_req_usr_nm" value="{{ selected_req.pur_req_usr_name }}" readonly>

                <label>User ID</label>
                <input type="text" name="pur_req_usr_id" value="{{ selected_req.pur_req_usr_id }}" readonly>

                <label>Department</label>
                <input type="text" name="pur_req_dept" value="{{ selected_req.pur_req_dept }}" readonly>

                <label>Item ID</label>
                <input type="text" name="pur_req_itm_id" value="{{ selected_req.pur_req_itm_id }}" readonly>

                <label>Item Name</label>
                <input type="text" value="{{ selected_req.pur_req_itm_name }}" readonly>

                <label>Quantity</label>
                <input type="text" value="{{ selected_req.pur_req_itm_qty }}" readonly>

                <label>Unit</label>
                <input type="text" value="{{ selected_req.pur_req_itm_unit }}" readonly>

                <label>Deadline</label>
                <input type="text" value="{{ selected_req.pur_req_date }}" readonly>

                <button name="action" value="approve" onclick="return confirm('Approve this request?')">Approve</button>
                <button name="action" value="reject" onclick="return confirm('Reject this request?')">Reject</button>
            </form>
        {% endif %}

    </div>
</div>
</body>
</html>
